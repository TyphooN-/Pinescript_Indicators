//@version=6
indicator("(KAMA)", shorttitle="KAMA", overlay=true)

// Input parameters
period_ama = input.int(10, title="AMA Period", minval=1)
fast_period_ema = input.int(2, title="Fast EMA Period", minval=1)
slow_period_ema = input.int(30, title="Slow EMA Period", minval=1)
src = input.source(open, title="Source")

// Calculate smoothing constants
fast_sc = 2.0 / (fast_period_ema + 1.0)
slow_sc = 2.0 / (slow_period_ema + 1.0)

// Function to calculate Efficiency Ratio (ER)
calculate_er(position) =>
    signal = math.abs(src[0] - src[position])
    noise = 0.0
    for i = 0 to position - 1
        noise += math.abs(src[i] - src[i + 1])
    noise != 0.0 ? signal / noise : 0.0

// Calculate KAMA
var float kama = na
if bar_index >= period_ama
    er = calculate_er(period_ama)
    current_sc = (er * (fast_sc - slow_sc)) + slow_sc
    smoothing_constant = math.pow(current_sc, 2)
    
    if na(kama)
        kama := src
    else
        kama := smoothing_constant * (src - kama[1]) + kama[1]

// Plot KAMA
plot(kama, title="KAMA", color=color.white, linewidth=2)

